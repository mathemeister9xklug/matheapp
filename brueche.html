<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mission: BrÃ¼che</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#121212">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <style>
        /* --- GAMING THEME & ANIMATION --- */
        :root {
            --bg-dark: #121212;
            --card-bg: #1e1e1e;
            --text-main: #ffffff;
            --accent: #3498db;  /* Challenger Blau */
            --success: #27ae60; /* Rookie GrÃ¼n */
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0; padding: 20px; color: var(--text-main);
            padding-bottom: 100px;
            /* Animierter Hintergrund */
            background: linear-gradient(-45deg, #0f2027, #203a43, #2c5364, #121212);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container { max-width: 700px; margin: 0 auto; }

        /* HEADER */
        header { text-align: center; margin-bottom: 40px; }
        h1 { margin: 0; text-transform: uppercase; letter-spacing: 2px; font-size: 1.5em; color: var(--accent); text-shadow: 0 0 10px rgba(52, 152, 219, 0.3); }
        .subtitle { color: #888; font-size: 0.9em; margin-top: 5px; }

        /* BRUCH-DARSTELLUNG (Dark Mode tauglich) */
        .frac { display: inline-block; text-align: center; vertical-align: middle; position: relative; top: -5px; font-size: 0.9em; padding: 0 4px; }
        .frac .top { display: block; border-bottom: 1px solid rgba(255,255,255,0.7); padding: 0 2px; }
        .frac .bottom { display: block; padding: 0 2px; }
        .mixed { font-size: 1.2em; margin-right: 4px; font-weight: bold; }

        /* SEKTIONEN */
        .section-title { 
            margin-top: 50px; margin-bottom: 20px; 
            font-size: 1em; color: var(--accent); font-weight: bold; text-transform: uppercase; letter-spacing: 1px;
            border-bottom: 1px solid #333; padding-bottom: 5px;
        }

        /* FRAGEN-KARTEN */
        .question-block { 
            background: rgba(30, 30, 30, 0.9); /* Leicht transparent */
            backdrop-filter: blur(5px);
            padding: 20px; 
            border-radius: 15px; 
            margin-bottom: 25px; 
            border: 1px solid #333;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .q-text { font-weight: 500; font-size: 1.1em; display: block; margin-bottom: 20px; }

        /* RADIO BUTTONS (Als Kacheln) */
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; } 
        @media(max-width: 500px) { .options-grid { grid-template-columns: 1fr; } }

        .radio-label { 
            display: flex; align-items: center; padding: 15px; 
            background: #2a2a2a; border: 1px solid #444; border-radius: 10px; 
            cursor: pointer; transition: all 0.2s; 
        }
        .radio-label:hover { background: #333; border-color: var(--accent); }
        /* Wenn ausgewÃ¤hlt (Checked) - kleiner Trick */
        .radio-label:has(input:checked) { background: rgba(52, 152, 219, 0.2); border-color: var(--accent); }
        
        .radio-label input { margin-right: 12px; accent-color: var(--accent); transform: scale(1.2); }

        /* INPUTS (User Info) */
        input[type="text"], select { 
            width: 100%; padding: 15px; 
            background: #222; border: 1px solid #444; color: white;
            border-radius: 8px; font-size: 16px; box-sizing: border-box; 
        }
        input:focus { outline: none; border-color: var(--accent); }

        /* BUTTON (Neon Style) */
        button { 
            display: block; width: 100%; padding: 20px; margin-top: 50px; 
            background: var(--success); color: white; border: none; border-radius: 12px; 
            font-size: 1.2em; font-weight: bold; cursor: pointer; 
            box-shadow: 0 0 20px rgba(39, 174, 96, 0.4); 
            transition: transform 0.1s;
        }
        button:hover { background: #2ecc71; transform: scale(1.02); }
        button:active { transform: scale(0.98); }
        button:disabled { background: #555; box-shadow: none; cursor: wait; }

    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Mission: BrÃ¼che</h1>
        <div class="subtitle">Diagnose-Protokoll v1.0</div>
    </header>

    <form id="quizForm" action="https://mathemeister9xklug.n8n.cloud/webhook/8b5a6681-d702-428b-9325-c9b803e69fba" method="POST">
        
        <input type="hidden" name="00_SCORE" id="scoreInput" value="">
        <input type="hidden" name="00_DAUER" id="durationInput" value="">
        <input type="hidden" name="Rohdaten" id="rawInput" value="">
        <input type="hidden" name="Thema" value="Brueche_Terme">
        
        <div id="welcomeMessage" style="display:none; background:rgba(39, 174, 96, 0.2); color:#2ecc71; padding:15px; border-radius:10px; margin-bottom:25px; border: 1px solid #27ae60; text-align:center;">
            ðŸ‘‹ Pilot <strong id="displayName">...</strong> erkannt.
            <br><small onclick="resetUser()" style="cursor:pointer; text-decoration:underline; font-size:0.8em; color:#aaa; display:block; margin-top:5px;">(IdentitÃ¤t wechseln)</small>
        </div>

        <div id="nameInputContainer" style="margin-bottom: 20px;">
            <label style="font-size:0.9em; color:#aaa; margin-bottom:8px; display:block;">Codename / Nickname:</label>
            <input type="text" name="01_name" id="nameInput" required placeholder="z.B. Jonas_729">
        </div>

        <div style="margin-bottom: 40px;">
            <label style="font-size:0.9em; color:#aaa; margin-bottom:8px; display:block;">Deine Basis (Schule):</label>
            <select name="Schule" id="schoolInput" required>
                <option value="" disabled selected>WÃ¤hle deine Schule...</option>
                <option value="Goethe-Gymnasium">Goethe-Gymnasium</option>
                <option value="Leibniz-Realschule">Leibniz-Realschule</option>
                <option value="Stadtteilschule">Stadtteilschule</option>
                <option value="Andere">Andere</option>
            </select>
        </div>

        <div class="section-title">Block A: Gemischte Zahlen</div>

        <div class="question-block">
            <span class="q-text">1. Schreibe als unechten Bruch: <span class="mixed">2</span><div class="frac"><span class="top">1</span><span class="bottom">3</span></div></span>
            <div class="options-grid">
                <label class="radio-label"><input type="radio" name="A01" value="âœ… RICHTIG (7/3)" required> <div class="frac"><span class="top">7</span><span class="bottom">3</span></div></label>
                <label class="radio-label"><input type="radio" name="A01" value="âŒ FEHLER (2/3)"> <div class="frac"><span class="top">2</span><span class="bottom">3</span></div></label>
                <label class="radio-label"><input type="radio" name="A01" value="âŒ FEHLER (3/3)"> <div class="frac"><span class="top">3</span><span class="bottom">3</span></div></label>
                <label class="radio-label"><input type="radio" name="A01" value="âŒ FEHLER (5/3)"> <div class="frac"><span class="top">5</span><span class="bottom">3</span></div></label>
            </div>
        </div>

        <div class="question-block">
            <span class="q-text">2. Schreibe als gemischte Zahl: <div class="frac"><span class="top">13</span><span class="bottom">4</span></div></span>
            <div class="options-grid">
                <label class="radio-label"><input type="radio" name="A02" value="âŒ FEHLER (3 2/4)"> <span class="mixed">3</span><div class="frac"><span class="top">2</span><span class="bottom">4</span></div></label>
                <label class="radio-label"><input type="radio" name="A02" value="âœ… RICHTIG (3 1/4)"> <span class="mixed">3</span><div class="frac"><span class="top">1</span><span class="bottom">4</span></div></label>
                <label class="radio-label"><input type="radio" name="A02" value="âŒ FEHLER (4 1/4)"> <span class="mixed">4</span><div class="frac"><span class="top">1</span><span class="bottom">4</span></div></label>
                <label class="radio-label"><input type="radio" name="A02" value="âŒ FEHLER (1.3)"> 3,25</label>
            </div>
        </div>

        <button type="submit" id="submitBtn">DATEN SENDEN ðŸš€</button>

    </form>
</div>

<script>
    // --- GEDÃ„CHTNIS ---
    const urlParams = new URLSearchParams(window.location.search);
    let user = urlParams.get('id') || localStorage.getItem('matheLigaUser');

    if (user) {
        localStorage.setItem('matheLigaUser', user);
        if(document.getElementById('nameInput')) document.getElementById('nameInput').value = user;
        if(document.getElementById('nameInputContainer')) document.getElementById('nameInputContainer').style.display = 'none';
        if(document.getElementById('displayName')) document.getElementById('displayName').innerText = user;
        if(document.getElementById('welcomeMessage')) document.getElementById('welcomeMessage').style.display = 'block';
    }

    function resetUser() {
        if(confirm("IdentitÃ¤t wirklich lÃ¶schen?")) {
            localStorage.removeItem('matheLigaUser');
            window.location.href = window.location.pathname; 
        }
    }

    // --- LOGIK ---
    const startTime = new Date();

    document.getElementById('quizForm').addEventListener('submit', function(e) {
        e.preventDefault(); 
        const btn = document.getElementById('submitBtn');
        btn.innerText = "Sende Paket...";
        btn.disabled = true;
        
        const name = document.getElementById('nameInput').value;
        const endTime = new Date();
        const seconds = Math.floor((endTime - startTime) / 1000);
        const durationString = Math.floor(seconds / 60) + "m " + (seconds % 60) + "s";

        const allRadios = document.querySelectorAll('input[type="radio"]:checked');
        let correct = 0;
        let details = "";
        
        allRadios.forEach(r => {
            if(r.value.includes('âœ…')) correct++;
            details += r.name + ": " + r.value + " | ";
        });
        
        // HIER FRAGENANZAHL ANPASSEN!
        const total = 25; 
        const scoreString = Math.round((correct / total) * 100) + "% (" + correct + "/" + total + ")";

        document.getElementById('scoreInput').value = scoreString;
        document.getElementById('durationInput').value = durationString;
        document.getElementById('rawInput').value = details;

        if(!user && name) {
            localStorage.setItem('matheLigaUser', name);
        }

        e.target.submit();
    });
</script>

</body>
</html>
