<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mathe-Liga: Dashboard</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#121212">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <style>
        /* --- DESIGN GRUNDLAGEN --- */
        :root {
            --bg: #121212;
            --card-bg: #1e1e1e;
            --text-main: #ffffff;
            --text-muted: #aaaaaa;
            --accent: #3498db;
            --success: #27ae60;
            --warn: #e67e22;
            --gold: #f1c40f;
            --neon-purple: #bc13fe;
        }

        body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background-color: var(--bg); color: var(--text-main); margin: 0; padding: 20px; padding-bottom: 80px; }
        .container { max-width: 600px; margin: 0 auto; }

        /* HEADER */
        header { text-align: center; margin-bottom: 30px; }
        h1 { margin: 0; font-size: 2em; letter-spacing: 1px; text-transform: uppercase; background: -webkit-linear-gradient(#eee, #999); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        .user-card { background: linear-gradient(135deg, #333, #222); padding: 15px; border-radius: 12px; margin-top: 20px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #444; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .user-name { font-weight: bold; font-size: 1.1em; color: #fff; }
        .user-status { font-size: 0.8em; background: #444; padding: 4px 8px; border-radius: 4px; color: #ccc; }

        /* BUTTONS */
        .btn-gold {
            display: block; width: 100%; box-sizing: border-box;
            background: linear-gradient(135deg, #f1c40f, #b7950b);
            color: #000; font-weight: bold; text-transform: uppercase; letter-spacing: 1px;
            padding: 15px; text-align: center; text-decoration: none; border-radius: 10px;
            margin-top: 20px; box-shadow: 0 0 15px rgba(241, 196, 15, 0.3);
            transition: transform 0.1s;
        }
        .btn-gold:active { transform: scale(0.98); }

        /* KAMPAGNEN-STRUKTUR */
        .campaign-header { margin-top: 40px; margin-bottom: 15px; display: flex; align-items: center; justify-content: space-between; }
        .campaign-title { font-size: 1.1em; font-weight: bold; color: var(--accent); text-transform: uppercase; letter-spacing: 1px; }
        .campaign-progress { font-size: 0.8em; color: var(--text-muted); }

        .path-container { position: relative; padding-left: 20px; border-left: 2px dashed #444; margin-left: 10px; }
        
        .card { 
            background: var(--card-bg); 
            padding: 15px; 
            border-radius: 12px; 
            display: flex; 
            align-items: center; 
            text-decoration: none; 
            color: white; 
            margin-bottom: 15px;
            position: relative; 
            transition: transform 0.2s;
            border: 1px solid #333;
        }

        /* Verbindungs-Linien Punkte */
        .card::before {
            content: ''; position: absolute; left: -26px; top: 50%; transform: translateY(-50%);
            width: 10px; height: 10px; background: #444; border-radius: 50%; border: 2px solid var(--bg);
        }

        /* STATUS STYLES */
        .card.done { border-left: 4px solid var(--success); }
        .card.done::before { background: var(--success); }
        
        .card.active { border-left: 4px solid var(--accent); background: #252525; box-shadow: 0 4px 15px rgba(52, 152, 219, 0.2); }
        .card.active:hover { transform: scale(1.02); }
        .card.active::before { background: var(--accent); box-shadow: 0 0 10px var(--accent); }

        .card.locked { opacity: 0.5; cursor: not-allowed; filter: grayscale(1); }
        
        .icon { font-size: 1.5em; margin-right: 15px; width: 30px; text-align: center; }
        .card-content { flex: 1; }
        .card-title { font-weight: bold; font-size: 1em; display: block; }
        .card-meta { font-size: 0.8em; color: var(--text-muted); margin-top: 2px; display: block; }
        
        .badge { font-size: 0.7em; padding: 2px 8px; border-radius: 4px; font-weight: bold; margin-left: 10px; text-transform: uppercase; }
        .badge-diag { background: #555; color: #fff; }
        .badge-game { background: var(--warn); color: #000; }

        /* FOOTER */
        .footer { text-align: center; margin-top: 50px; font-size: 0.8em; color: #555; }
        .reset-link { color: #555; text-decoration: underline; cursor: pointer; }

        /* --- GATEKEEPER OVERLAY --- */
        #gatekeeper {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(10, 10, 15, 0.98); z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            backdrop-filter: blur(10px);
            transition: opacity 0.5s;
        }
        #gatekeeper.hidden { opacity: 0; pointer-events: none; }

        .gk-content { width: 90%; max-width: 400px; text-align: center; }
        .gk-title { font-size: 2em; margin-bottom: 20px; color: var(--accent); text-transform: uppercase; letter-spacing: 2px; }
        
        .nick-box {
            background: #222; padding: 20px; border-radius: 15px; border: 1px solid #444;
            margin-bottom: 20px;
        }
        .generated-nick { font-size: 1.8em; font-weight: bold; color: var(--neon-purple); display: block; margin-bottom: 10px; letter-spacing: 1px; }
        
        .btn-refresh {
            background: transparent; border: 1px solid #666; color: #aaa; padding: 5px 15px;
            border-radius: 20px; cursor: pointer; font-size: 0.9em;
        }
        .btn-refresh:hover { color: white; border-color: white; }

        .school-select {
            width: 100%; padding: 15px; margin-bottom: 30px; background: #333; border: 1px solid #555;
            color: white; border-radius: 10px; font-size: 1em; box-sizing: border-box;
        }

        .btn-start {
            width: 100%; padding: 20px; background: var(--success); color: white; border: none;
            border-radius: 50px; font-size: 1.2em; font-weight: bold; cursor: pointer;
            box-shadow: 0 0 20px rgba(39, 174, 96, 0.5); text-transform: uppercase;
        }
        .btn-start:hover { transform: scale(1.05); background: #2ecc71; }

    </style>
</head>
<body>

<div id="gatekeeper">
    <div class="gk-content">
        <h1 class="gk-title">Identifikation</h1>
        <p style="color:#888; margin-bottom:30px;">Willkommen in der Liga. Erstelle dein Profil.</p>

        <div class="nick-box">
            <span class="generated-nick" id="nickDisplay">...</span>
            <button class="btn-refresh" onclick="generateNick()">üé≤ Neu W√ºrfeln</button>
        </div>

        <div style="text-align: left; margin-bottom: 5px; color: #aaa; font-size: 0.9em; margin-left: 5px;">Deine Basis (Schule):</div>
        <input list="schools" id="schoolInput" class="school-select" placeholder="Schule suchen oder eingeben...">
        <datalist id="schools">
            <option value="Goethe-Gymnasium">
            <option value="Leibniz-Realschule">
            <option value="Stadtteilschule Mitte">
            <option value="Gymnasium Nord">
        </datalist>

        <button class="btn-start" onclick="saveAndEnter()">Mission Starten üöÄ</button>
    </div>
</div>

<div class="container">
    <header>
        <h1>Mathe Liga üèÜ</h1>
        <div class="user-card" id="userCard" style="display:none;">
            <div>
                <span style="display:block; font-size:0.8em; color:#888;">Pilot:</span>
                <span class="user-name" id="userNameDisplay">Gast</span>
            </div>
            <span class="user-status">Rookie</span>
        </div>

        <a href="leaderboard.html" class="btn-gold">
            üèÜ Globales Ranking ansehen
        </a>
    </header>

    <div class="campaign-header">
        <span class="campaign-title">üçï Mission: Br√ºche</span>
        <span class="campaign-progress">Level 1-3</span>
    </div>

    <div class="path-container">
        
        <a href="brueche.html" class="card done">
            <span class="icon">ü©∫</span>
            <div class="card-content">
                <span class="card-title">Check-Up</span>
                <span class="card-meta">Diagnose ‚Ä¢ 25 Fragen</span>
            </div>
            <span class="badge badge-diag">Pflicht</span>
        </a>

        <a href="speed_kuerzen.html" class="card active">
            <span class="icon">‚ö°</span>
            <div class="card-content">
                <span class="card-title">Speed-K√ºrzen</span>
                <span class="card-meta">Time Attack ‚Ä¢ 60 Sek</span>
            </div>
            <span class="badge badge-game">Game</span>
        </a>

        <div class="card locked">
            <span class="icon">üëë</span>
            <div class="card-content">
                <span class="card-title">Der Nenner-Killer</span>
                <span class="card-meta">Boss Battle ‚Ä¢ Schwer</span>
            </div>
            <span class="lock-icon">üîí</span>
        </div>

    </div>

    <div class="campaign-header" style="opacity:0.5; margin-top:50px;">
        <span class="campaign-title">üìê Mission: Geometrie</span>
        <span class="campaign-progress">Bald verf√ºgbar</span>
    </div>
    <div class="path-container" style="opacity:0.5;">
        <div class="card locked">
            <span class="icon">üìê</span>
            <div class="card-content">
                <span class="card-title">Winkel-Jagd</span>
                <span class="card-meta">Training</span>
            </div>
            <span class="lock-icon">üîí</span>
        </div>
    </div>

    <div class="footer">
        Mathe-Liga App v1.3<br>
        <span class="reset-link" onclick="logout()">Nicht du? Ausloggen</span>
    </div>

</div>

<script>
    // --- NICKNAME POOLS ---
    const prefixes = [
        "Nano", "Giga", "Tera", "Piko", "Exa", "Cyber", "Neo", "Retro", "Meta", 
        "Techno", "Astro", "Cosmo", "Solar", "Lunar", "Sonic", "Data", "Byte", 
        "Pixel", "Hyper", "Mega", "Ultra", "Super", "Prime", "Alpha", "Beta", 
        "Gamma", "Omega", "Nova", "Apex", "Neon", "Chrom", "Titan", "Cobalt", 
        "Toxic", "Plasma", "Iron", "Steel", "Frozen"
    ];
    
    const nouns = [
        "Panda", "Wolf", "Fuchs", "Tiger", "L√∂we", "Falke", "Adler", "Hai", 
        "Wal", "Otter", "Lama", "Koala", "Eule", "Rabe", "Cobra", "Viper", 
        "Rex", "Raptor", "B√§r", "Gecko", "Bot", "Drohne", "Pilot", "Scout", 
        "Unit", "Chip", "Core", "Node", "Grid", "Matrix", "Loop", "Prisma", 
        "Kugel", "Toast", "Pizza", "Keks", "Taco", "Burger", "Donut", "Muffin", 
        "Blitz", "Sturm", "Rakete", "Komet", "Stern", "Planet"
    ];

    let currentNick = "";

    // --- GATEKEEPER LOGIC ---
    document.addEventListener("DOMContentLoaded", () => {
        const storedUser = localStorage.getItem('matheLigaUser');
        const storedSchool = localStorage.getItem('matheLigaSchool');

        // 1. Check: User vorhanden?
        if (storedUser && storedSchool) {
            // Zugang gew√§hren
            unlockDashboard(storedUser);
        } else {
            // Gatekeeper aktivieren
            initGatekeeper();
        }

        // Links personalisieren (auch wenn Gatekeeper noch aktiv ist, f√ºr sp√§ter)
        updateLinks();
    });

    function initGatekeeper() {
        const gk = document.getElementById('gatekeeper');
        gk.classList.remove('hidden'); // Sicherstellen, dass sichtbar
        
        generateNick(); // Ersten Namen w√ºrfeln

        // Magic Link Check (?school=...)
        const urlParams = new URLSearchParams(window.location.search);
        const magicSchool = urlParams.get('school');
        
        if (magicSchool) {
            const schoolInput = document.getElementById('schoolInput');
            schoolInput.value = magicSchool;
            // Optional: Visuelles Feedback, dass Link funktioniert hat
            schoolInput.style.borderColor = "#27ae60"; 
            schoolInput.style.backgroundColor = "rgba(39, 174, 96, 0.1)";
        }
    }

    function generateNick() {
        const p = prefixes[Math.floor(Math.random() * prefixes.length)];
        const n = nouns[Math.floor(Math.random() * nouns.length)];
        const num = Math.floor(Math.random() * 90) + 10; // 10-99
        currentNick = `${p}_${n}_${num}`;
        document.getElementById('nickDisplay').innerText = currentNick;
    }

    function saveAndEnter() {
        const schoolVal = document.getElementById('schoolInput').value.trim();
        
        if (!schoolVal) {
            alert("Bitte w√§hle deine Schule (oder gib sie ein).");
            return;
        }

        // Speichern
        localStorage.setItem('matheLigaUser', currentNick);
        localStorage.setItem('matheLigaSchool', schoolVal);

        // UI Update
        document.getElementById('gatekeeper').classList.add('hidden');
        unlockDashboard(currentNick);
        updateLinks();
    }

    function unlockDashboard(user) {
        document.getElementById('userNameDisplay').innerText = user;
        document.getElementById('userCard').style.display = 'flex';
        document.getElementById('gatekeeper').classList.add('hidden');
    }

    function updateLinks() {
        const user = localStorage.getItem('matheLigaUser');
        if (!user) return;

        // An alle Links die ID h√§ngen (f√ºr simples Tracking im Query String)
        const links = document.querySelectorAll('a[href]');
        links.forEach(link => {
            if(link.href.includes('.html') && !link.href.includes('id=')) {
                const separator = link.href.includes('?') ? '&' : '?';
                link.href = link.getAttribute('href') + separator + "id=" + encodeURIComponent(user);
            }
        });
    }

    function logout() {
        if(confirm("Bist du sicher? Dein Fortschritt auf diesem Ger√§t wird getrennt.")) {
            localStorage.removeItem('matheLigaUser');
            localStorage.removeItem('matheLigaSchool');
            location.reload();
        }
    }
</script>

</body>
</html>
